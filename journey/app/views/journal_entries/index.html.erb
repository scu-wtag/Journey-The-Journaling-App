<% content_for :styles do %>
  <%= stylesheet_link_tag "views/journals/new" %>
<% end %>

<header class="topbar">
  <div class="brand-pill"><%= t("journal.title", default: "Journey") %></div>
  <div class="topbar__spacer"></div>
</header>

  <div class="shell">
    <nav class="sidenav">
      <button type="button" class="nav-btn" title="Dashboard" aria-label="Dashboard">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="8" height="8"/><rect x="13" y="3" width="8" height="5"/><rect x="13" y="10" width="8" height="11"/><rect x="3" y="13" width="8" height="8"/></svg>
      </button>
      <button type="button" class="nav-btn" title="Profile" aria-label="Profile">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/></svg>
      </button>
      
      <%= link_to new_journal_entry_path,
                  class: "nav-btn",
                  title: t("journal.index.new", default: "New"),
                  aria: { label: "New" } do %>
        <svg viewBox="0 0 24 24"
            width="20"
            height="20"
            fill="none"
            stroke="currentColor"
            stroke-width="2">
          <path d="M12 5v14M5 12h14"/>
        </svg>
      <% end %>      
      <button type="button" class="nav-btn" title="Tasks" aria-label="Tasks">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="12" height="16" rx="2"/><path d="M9 4h6v3H9zM9 10h6M9 14h6"/></svg>
      </button>
    </nav>

  <main class="main">
    <section class="journal journal-index">
      <header class="head row tight">
        <h2 style="margin:0"><%= t("journal.index.dashboard", default: "Dashboard") %></h2>
        <%= link_to t("journal.index.new"),
        new_journal_entry_path,
        class: "btn btn-primary" %>
      </header>

      <% if @journal_entries.any? %>
        <% grouped = @journal_entries.group_by(&:entry_date) %>

        <% grouped.sort_by { |date, _| date || Date.new(1970,1,1) }.reverse_each do |date, items| %>
          <div class="day-group">
            <div class="date-pill">
              <%= (
                if date
                  l(date, format: "%-d.%m.%Y")
                else
                  t("journal.index.no_date", default: "No date")
                end
              ) %>
            </div>

            <% items.each do |e| %>
              <article class="log-card">
                <div class="log-card__meta">
                  <% if e.time_from || e.time_to %>
                    <span class="time"><%= [e.time_from&.strftime("%H:%M"), e.time_to&.strftime("%H:%M")].compact.join("–") %></span>
                  <% end %>
                </div>

                <div class="log-card__body">
                  <h3 class="log-title">
                    <span class="muted"><%= t("journal.index.empty", default: "Log entry:") %></span>
                    <%= link_to (e.title.presence || t("journal.untitled", default: "Untitled")), e %>
                  </h3>
                  <p class="log-text">
                    <%= (e.body&.to_plain_text || "").strip.truncate(160, omission: "…") %>
                  </p>
                </div>

                <div class="log-card__actions">
                  <%= link_to t("common.edit", default: "edit"),
                  edit_journal_entry_path(e),
                  class: "btn btn-ghost" %>
                  <%= button_to t("common.delete", default: "delete"),
                  e,
                  method: :delete,
                  form: {
                    data: {
                      turbo_confirm: t("common.confirm_delete", default: "Delete this entry?"),
                    },
                  },
                  class: "btn btn-danger" %>
                </div>

                <%= link_to e, class: "peek", title: t("common.view", default: "View") do %>
                  <svg
                    viewBox="0 0 24 24"
                    width="18"
                    height="18"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/><circle cx="12" cy="12" r="3"/>
                  </svg>
                <% end %>
              </article>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <div class="empty">
          <p><%= t("journal.index.empty", default: "No entries yet.") %></p>
        </div>
      <% end %>
    </section>
  </main>
</div>
