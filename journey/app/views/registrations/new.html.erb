<h1 class="signup__page-title"><%= t("users.new.title") %></h1>

<section class="signup">
  <div class="signup__card">
    <h2 class="signup__title"><%= t("users.new.title") %></h2>

    <% if @user.errors.any? %>
      <div class="signup__errors" role="alert" aria-live="polite">
        <p class="signup__errors-title"><strong><%= t("users.create.failed") %></strong></p>
        <ul class="signup__errors-list">
          <% @user.errors.full_messages.each do |m| %>
            <li class="signup__errors-item"><%= m %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= form_with model: @user,
                  url: registrations_path,
                  data: { turbo: false },
                  html: { class: "signup__form form" } do |f| %>

      <div class="field">
        <%= f.label :email, t("users.new.fields.email"), class: "field__label" %>
        <%= f.email_field :email, required: true,
              autocomplete: "username", class: "field__input" %>
      </div>

      <div class="field">
        <%= f.label :name, t("users.new.fields.name"), class: "field__label" %>
        <%= f.text_field :name, required: true,
              autocomplete: "name", class: "field__input" %>
      </div>

      <div class="field">
        <%= f.label :password, t("users.new.fields.password"), class: "field__label" %>
        <%= f.password_field :password, required: true,
              autocomplete: "new-password", class: "field__input" %>
      </div>

      <div class="field">
        <%= f.label :password_confirmation, t("users.new.fields.password_confirmation"), class: "field__label" %>
        <%= f.password_field :password_confirmation, required: true,
              autocomplete: "new-password", class: "field__input" %>
      </div>

      <%= f.fields_for :profile do |p| %>
        <fieldset class="signup__fieldset">
          <legend class="signup__legend"><%= t("users.new.optional_legend") %></legend>

          <div class="field">
            <span class="field__label"><%= t("users.new.phone") %></span>
            <div class="field__phone field__phone--row">
              <%= p.select :phone_country_code,
                    options_for_select(
                      [
                        [t("users.new.phone_countries.ch"), "41"],
                        [t("users.new.phone_countries.de"), "49"],
                        [t("users.new.phone_countries.at"), "43"],
                        [t("users.new.phone_countries.sep"), "---"],
                        [t("users.new.phone_countries.uk"), "44"],
                        [t("users.new.phone_countries.us"), "1"],
                        [t("users.new.phone_countries.jp"), "81"],
                        [t("users.new.phone_countries.au"), "61"]
                      ],
                      selected: p.object&.phone_country_code || "41"
                    ),
                    {}, class: "field__phone field__phone--dial" %>

              <%= p.telephone_field :phone_local,
                    placeholder: t("users.new.placeholders.phone_local"),
                    inputmode: "tel",
                    pattern: "^[0-9][0-9\\s\\-]{5,17}$",
                    class: "field__phone field__phone--number" %>
            </div>
            <%= p.hidden_field :phone %>
          </div>

          <div class="field">
            <%= p.label :birthday, t("users.new.birthday"), class: "field__label" %>
            <%= p.date_field :birthday, class: "field__input" %>
          </div>

          <div class="field">
            <%= p.label :country, t("users.new.country"), class: "field__label" %>
            <%= p.text_field :country,
                  placeholder: t("users.new.placeholders.country"),
                  class: "field__input" %>
          </div>

          <div class="field">
            <%= p.label :headquarters, t("users.new.headquarters"), class: "field__label" %>
            <%= p.text_field :headquarters,
                  placeholder: t("users.new.placeholders.headquarters"),
                  class: "field__input" %>
          </div>
        </fieldset>
      <% end %>

      <div class="form__actions">
        <%= f.submit t("users.new.submit"), class: "form__btn" %>
      </div>
    <% end %>
  </div>
</section>
